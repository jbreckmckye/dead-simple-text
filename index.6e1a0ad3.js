function e(e){return e&&e.__esModule?e.default:e}var t,i,s={},n=[];function a(e){var t,i,s=[],a=function(...t){var i;return t.length?function(t){if(t!==e||null!==e&&"object"==typeof e){var i=e;e=t;for(let t=s.length-1;t>-1;t--)s[t](e,i)}}(t[0]):((i=n[n.length-1])&&o(i),e)},o=(t,i)=>{~s.indexOf(t)||s.push(t),i&&t(e)};return a.subscribe=o,a.unsubscribe=e=>{(i=(t=s).indexOf(e))>-1&&t.splice(i,1)},a}a.computed=e=>{var t=a();return function i(){var s,a;(function(){if(n.indexOf(i)>-1)throw Error("Circular computation")})(),n.push(i);try{a=e()}catch(e){s=e}if(n.pop(),s)throw s;t(a)}(),t},a.from=e=>{var t=a();return e(t),t},s=a;const o={type:"text/plain;charset=utf-8"},l=document.createElement("a");function r(e){return e.split(/\r\n|\r|\n/)}(t=i||(i={}))[t.WAITING=0]="WAITING",t[t.HAS_LOCK=1]="HAS_LOCK",t[t.LOCK_REJECTED=2]="LOCK_REJECTED",t[t.DISABLED=3]="DISABLED",t[t.RELEASED=4]="RELEASED";const h="Dead Simple Text.txt",c=/*@__PURE__*/e(s)({key:"__INIT"}),u=new class{constructor(){this.focusContent=()=>{this.textarea.focus()},this.getContent=()=>this.textarea.value,this.getCursor=()=>[this.textarea.selectionStart,this.textarea.selectionEnd],this.getFilename=()=>this.filename.value,this.getCursorPosition=()=>this.textarea.selectionStart,this.setContent=e=>{this.textarea.value=e},this.setCursor=(e,t)=>{this.textarea.setSelectionRange(e,t)},this.setFilenameText=e=>{this.filename.value=e},this.setUIReady=()=>{this.toolbar.classList.remove("toolbar--loading")},this.textChangedFlag=!1,this.toolbar=this.getEl("toolbar"),this.filename=this.getEl("filename"),this.fileNew=this.getEl("fileNew"),this.fileOpen=this.getEl("fileOpen"),this.fileSave=this.getEl("fileSave"),this.textarea=this.getEl("textarea"),this.fileOpenHelper=document.createElement("input"),this.fileOpenHelper.type="file",this.fileOpenHelper.accept=".css,.markdown,.md,.js,.json,.jsx,.scss,.svg,.ts,.tsx,.txt,.xml",this.shiftOn=!1,this.addEvents()}getEl(e){let t=document.getElementById(e);if(t)return t;throw Error(`No element found for selector ${e}`)}addEvents(){this.fileOpen.addEventListener("click",()=>{this.fileOpenHelper.click()},!1),this.fileOpenHelper.addEventListener("change",()=>{this.fileOpenHelper.files&&c({key:"OPEN_FILE",file:this.fileOpenHelper.files[0]})},!1),this.fileSave.addEventListener("click",()=>{c({key:"SAVE_FILE"})}),this.fileNew.addEventListener("click",()=>{c({key:"NEW_FILE"})}),this.filename.addEventListener("change",e=>{c({key:"CHANGE_FILE_NAME",name:e.target.value})}),this.textarea.addEventListener("input",()=>{this.textChangedFlag||(this.textChangedFlag=!0)}),this.textarea.addEventListener("keydown",e=>{"Tab"==e.key?(e.preventDefault(),this.shiftOn?c({key:"UNINSERT_TAB"}):c({key:"INSERT_TAB"})):"F6"==e.key?(e.preventDefault(),this.fileNew.focus()):"Shift"==e.key&&(this.shiftOn=!0)}),this.textarea.addEventListener("keyup",e=>{"Shift"==e.key&&(this.shiftOn=!1)}),this.textarea.addEventListener("change",()=>{c({key:"TEXT_CHANGE"})})}},d=new class{constructor(t){this.name=t,this.state=/*@__PURE__*/e(s)("locks"in window.navigator?0:3),this.releaseLock=()=>{},3!==this.state()?(console.log({INFO:"Acquiring lock"}),this.acquireLock()):console.log({INFO:"Web Locks API missing / disabled"})}readDocument(){return window.localStorage.getItem(this.name)}writeDocument(e){try{return window.localStorage.setItem(this.name,e)}catch{}}acquireLock(){window.navigator.locks.request(this.name,{ifAvailable:!0},e=>{if(e)return console.log({INFO:"Acquired lock"}),this.state(1),new Promise(e=>{this.releaseLock=()=>{this.state(4),e("Released lock"),console.log({INFO:"Released lock"})}});console.log({INFO:"Unable to acquire lock"}),this.state(2)})}}(h);new class{constructor(e,t){this.view=e,this.storage=t,c.subscribe(e=>this.handleUserEvents(e),!0),t.state.subscribe(e=>this.handleStorageEvents(e),!0)}async handleUserEvents(e){switch(console.log("handle user event:",e),e.key){case"NEW_FILE":this.storage.releaseLock(),this.view.setFilenameText("untitled.txt"),this.view.setContent("");break;case"OPEN_FILE":var t;this.storage.releaseLock(),this.view.setFilenameText(e.file.name),this.view.setContent(await (t=e.file,new Promise((e,i)=>{let s=new FileReader;s.onload=()=>e(s.result),s.onerror=e=>i(e),s.readAsText(t)}))),this.view.focusContent();break;case"SAVE_FILE":{let e=this.view.getFilename();e.length?function(e,t){let i=new Blob([e],o),s=URL.createObjectURL(i);l.href=s,l.download=t,l.click(),URL.revokeObjectURL(s)}(function(e){let t=e.match(/(\s)+$/g);return t?e.substr(0,t.index):e}(this.view.getContent()),e):window.alert("Please provide a filename");break}case"INSERT_TAB":this.insertTab();break;case"UNINSERT_TAB":this.uninsertTab();break;case"TEXT_CHANGE":this.storage.state()===i.HAS_LOCK&&this.storage.writeDocument(this.view.getContent());break;case"CHANGE_FILE_NAME":this.storage.state()===i.HAS_LOCK?e.name!==h&&this.storage.releaseLock():e.name===h&&this.view.setFilenameText("untitled.txt")}}handleStorageEvents(e){switch(console.log("handle storage event:",e),e){case i.DISABLED:case i.LOCK_REJECTED:window.setTimeout(()=>{this.view.setFilenameText("untitled.txt")},10);break;case i.HAS_LOCK:this.view.setFilenameText(h),this.view.setContent(this.storage.readDocument()||'Welcome to Dead Simple Text!\n\nThis default document is your "journal", which is kept in sync with your browser storage. Any changes you make\nto "Dead Simple Text.txt" will be kept for your next visit.\n\nIf you change the document name (top right) you will begin working on a separate document; this won\'t be synced, but\nyou can download it using the Save button.\n\nhttps://github.com/jbreckmckye/dead-simple-text')}e!==i.WAITING&&this.view.setUIReady()}insertTab(){let[e,t]=this.view.getCursor(),i=this.view.getContent(),s="    ";if(e==t)document.execCommand("insertText",void 0,s);else{let n=r(i),a="",o=0,l=0,h=!1;for(let i=0;i<n.length;i++){let r=o,c=o+n[i].length+1;i>0&&(a+="\n"),c>e&&r<t&&(a+=s,l++),r==e&&(h=!0),a+=n[i],o=c}document.execCommand("selectAll"),document.execCommand("insertText",void 0,a);let c=h?e:e+s.length,u=t+l*s.length;this.view.setCursor(c,u)}}uninsertTab(){let[e,t]=this.view.getCursor(),i=this.view.getContent(),s=/^    /g;if(e!=t){let n=r(i),a="",o=0,l=0,h=!1;for(let i=0;i<n.length;i++){let r=n[i],c=o,u=o+r.length+1,d=r;i>0&&(a+="\n"),u>e&&c<t&&(d=r.replace(s,"")),c==e&&(h=!0),a+=d,l+=r.length-d.length,o=u}document.execCommand("selectAll"),document.execCommand("insertText",void 0,a);let c=h?e:e-4,u=t-l;this.view.setCursor(c,u)}}}(u,d);
//# sourceMappingURL=index.6e1a0ad3.js.map
